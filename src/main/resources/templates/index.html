<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>To-Do List</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 60%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #f4f4f4; }
        input[type=text] { padding: 5px; width: 200px; }
        button { padding: 5px 10px; margin-left: 5px; }
    </style>
</head>
<body>
<h1>✅ To-Do List</h1>

<!-- 입력 폼 -->
<form id="todo-form">
    <input type="text" id="task" placeholder="할 일을 입력하세요" required />
    <button type="submit">추가</button>
</form>

<!-- 목록 -->
<table id="todo-table">
    <thead>
    <tr>
        <th>ID</th>
        <th>할 일</th>
        <th>완료 여부</th>
        <th>액션</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const apiUrl = '/api/todos';

    // 할 일 목록 불러오기
    async function loadTodos() {
        const res = await fetch(apiUrl);
        const todos = await res.json();
        const tbody = document.querySelector('#todo-table tbody');
        tbody.innerHTML = '';

        todos.forEach(todo => {
            const row = `
                    <tr>
                        <td>${todo.id}</td>
                        <td>${todo.task}</td>
                        <td>
                            <input type="checkbox" ${todo.completed ? 'checked' : ''}
                                onchange="updateTodo(${todo.id}, '${todo.task}', this.checked)" />
                        </td>
                        <td>
                            <button onclick="deleteTodo(${todo.id})">삭제</button>
                        </td>
                    </tr>
                `;
            tbody.innerHTML += row;
        });
    }

    // 할 일 추가
    document.getElementById('todo-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const task = document.getElementById('task').value;
        await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ task, completed: false })
        });
        document.getElementById('task').value = '';
        loadTodos();
    });

    // 할 일 수정 (완료 여부 토글)
    async function updateTodo(id, task, completed) {
        await fetch(`${apiUrl}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ task, completed })
        });
        loadTodos();
    }

    // 할 일 삭제
    async function deleteTodo(id) {
        await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
        loadTodos();
    }

    // 초기 로드
    loadTodos();
</script>
</body>
</html>
